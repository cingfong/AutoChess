<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Document</title>
  </head>
  <body>
    <link rel="stylesheet" href="./prepare.css" />
    <link rel="stylesheet" href="./fight.css" />
    <div id="app">
      <div class="prepare-wrap">
        <div class="board-wrap"></div>
        <div class="user-piece-wrap"></div>
        <div class="shop-wrap">
          <div class="shop-title">商店</div>
          <div class="shop-piece"></div>
          <div class="shop-close"></div>
        </div>
        <div class="user-money-wrap">
          <div class="user-money-pre">玩家金額:</div>
          <div class="user-money"></div>
        </div>
        <div class="shop-show-btn">商店</div>
        <div class="fight-show-btn">戰鬥</div>
      </div>
      <div class="fight-wrap hidden">
        <div class="fight-board-wrap">
          <div class="compute-board-wrap"></div>
          <div class="user-board-wrap"></div>
        </div>
      </div>
    </div>
    <!-- <script src="https://cdn.tailwindcss.com"></script> -->
    <script type="module">
      import Shop from "./shop.js";
      import Chess from "./chess.js";
      import User from "./user.js";
      import Stage from "./stage.js";
      // 商店
      // 棋盤
      function mainRnder() {
        const _globalAutoChess = {
          User: new User(),
          Stage: new Stage(),
          ready: function () {
            this.Stage.setUserObject(this.User);
          },
          prepareRender: function () {
            this.User.render();
          },
          getUser: function () {
            return this.User;
          },
          fightRender: function () {
            this.Stage.renderBoard();
          },
          fight: function () {
            return this.Stage.fight();
          },
        };

        window._globalAutoChess = _globalAutoChess;
        _globalAutoChess.ready();
        _globalAutoChess.prepareRender();
        _globalAutoChess.fightRender();
        setTimeout(() => {
          _globalAutoChess.fight().then((winner) => {
            alert("winner: " + winner);
            console.log("winner: " + winner);
          });
        }, 0);
        testFightRender();
      }
      function testFightRender() {
        const fightWrap = document.querySelector(".fight-wrap");
        fightWrap.classList.remove("hidden");
      }
      mainRnder();
      // 動畫觀測器
      // window.requestAnimationFrame(() => {
      // })
      // renderPiece()
      // render();
      window.onload = () => {
        console.log("load");
        const fightBtn = document.querySelector(".fight-show-btn");
        const fightWrap = document.querySelector(".fight-wrap");
        fightBtn.addEventListener("click", () => {
          _globalAutoChess.fightRender();
          fightWrap.classList.remove("hidden");
        });
      };
    </script>
  </body>
</html>
